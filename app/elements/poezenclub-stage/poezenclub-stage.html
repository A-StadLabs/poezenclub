<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../poes-aai/poes-aai.html">

<dom-module id="poezenclub-stage">
<template>
  <style>
    :host {
      display: block;
    }

    neon-animated-pages {
      height: 100%;
    }

    paper-drawer-panel {
/*        width: 100%;
overflow-y: scroll;*/

}

/*      #main {
        min-height: 100vh;
        width: 100vw;
      }
      */

      .drawer {
        background-color: var(--pink-theme-color);
        @apply(--layout-vertical);
        @apply(--layout-center);
        overflow-y: scroll;
        overflow-x: hidden;
        height: 100%;
        box-sizing:border-box;
        padding: 0px;
      }


      .eighty {
        width: 80%;
      }

      .middle {
        text-align: center;
      }



      .canvaspink {
        @apply(--canvas-pink);
        @apply(--layout-vertical);
        @apply(--layout-center-center);
        min-height: 100vh;
      }

      .canvas2pink {
        width: 100vw;
        overflow-y: scroll;
        background-color: var(--pink-theme-color);
        /*      background-color: red;*/
        @apply(--layout-vertical);
        @apply(--layout-start);
        @apply(--layout-center);
        min-height: 85vh;
      }


      .canvasblank {
        @apply(--total-canvas);
        @apply(--layout-vertical);
        @apply(--layout-center);
        @apply(--layout-start);
        box-sizing:border-box;
        padding: 50px;
        background-color: white;
      }

      

      .choice {
        width: 100%;
      }


      h1 {
        @apply(--theme-font-title);
      }

      h2 {
        @apply(--theme-font-subhead);
        text-align: center;
      }

      p {
        @apply(--theme-font-body1);
      }


      button {
        min-width: 150px;
      }

      .whitespace {
        height: 20px;
      }

      .main {
        @apply(--main-btn);
      }
      .main:hover {
        @apply(--btns-hovercolors);
      }
      .medium {
        @apply(--medium-btn);
      }
      .medium:hover {
        @apply(--btns-hovercolors);
      }
      .small {
        min-width: 100px;
        @apply(--small-btn);
      }
      .small:hover {
        @apply(--btns-altcolors);
      }


      #memberloader {
        padding: 25px;
        border-box:box-sizing;

        width: 250px;
      }



      /*  POEZENSELECTOR  */

      #poezenselector .iron-selected {
        background-color: rgba(255,255,255,0.25);
        border: 2px solid white;

      }

      .poesitem {
        background-color: rgba(0,0,0,0.1);
        border-radius: 50%;
        width: 100px;
        height: 100px;
        overflow: hidden;
        margin: 5px;
        border: 2px solid transparent;

      }

      .poesitem img {
        width: 100%;
        height: 100%;
      }

      #poezenselector {
        width: 100vw;
        max-width: 800px;
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
        @apply(--layout-center-center);

      }



      /*  NAME PUSS */

      paper-button {
        text-transform: capitalize;
        font-size: 28px;
        background-color: black;
        color: white;
        --paper-button-ink-color: black;
        --paper-button-flat-keyboard-focus: {
          background-color: black;
          color: white !important;
        };
        --paper-button-raised-keyboard-focus: {
          background-color: black !important;
          color: white !important;
        };
      }
      paper-button:hover {
        background-color: white;
        color: black;
      }

      paper-input-container {
        width: 250px;
        background-color: white;
        margin-bottom: 20px;
        padding: 30px;
      }

      .paper-input-container-0 label, paper-input-char-counter, .paper-input-container-0 input {
        font-family: Indieflower;
        /*      text-transform: capitalize;*/
      }

      .validatorz {
        width: 84vw;
        max-width: 100%;
      }

      .validatorzsmall {
        width: 80%;
        text-align: center;
      }

      poes-validatordetail {
        height: 100px;
        width: 100%;
      }

      .validatordetailsmall {
        height: 70px;
        width: 100%;
      }



      hr {
        color: rgba(0,0,0,0.15);
        background-color: rgba(0,0,0,0.25);
        height: 1px;
        outline: none;
        border: 0px;
        margin: 0px;
        padding: 0px;
      }

      .errormsg {
        width: 100%;
        background-color: black;
        height: 50px;
        color: white;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
      }

      .toppertje {
        width: 100%;
        box-sizing:border-box;
        padding: 20px;
        @apply(--pink-bgcolor);
        @apply(--layout-horizontal);
        @apply(--layout-center);
        @apply(--layout-end-justified);
      }

      .valideerbtn {
        outline: 0; 
        margin: 5px 5px 5px 0px;
        box-sizing:border-box;
        border-radius: 8px;
        cursor: pointer;
        @apply(--theme-font-button);
        background-color: transparent;
        border: 1px solid black; 
        padding: 15px 15px 15px 15px;
        font-size: 22px;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
      }



      .incomingpic {
        width: 250px;
        height: 250px;
        background-color: rgba(0,0,0,0.1);
        border-radius: 50%;
        overflow: hidden;
      }

      .incomingpic img {
        width: 100%;
        height: 100%;
      }

      .version {
        width: 100%;
      }


      .version h2 {
        font-size: 22px;
      }

      .version p  {
        font-size: 26px;
      }

      .languagepicker {
        width: 100%;
        background: var(--pink-theme-color);
        box-sizing:border-box;
        padding: 20px;
        border-bottom: 1px solid rgba(0,0,0,0.25);

/*    @apply(--layout-horizontal);
@apply(--layout-start-justified);*/
}

.languagepickersel {
  height: 100%;
  @apply(--layout-horizontal);
  @apply(--layout-center);
}

.languagepickersel .iron-selected {
  background-color: rgba(0,0,0,1);
  text-decoration: underline;
  color: var(--pink-theme-color);
}

.language {
  @apply(--layout-horizontal);
  @apply(--layout-center-center);
  color: black;
  width: 50px;
  height: 40px;
  border-radius: 10px;
  padding: 0px;
  cursor: pointer;
  @apply(--theme-alt-general);
}



.language h2 {
  font-size: 16px;
}


.topbar {
  width: 100%;
  background: var(--pink-theme-color);
  height: 15vh;
  max-height: 150px;
  box-sizing:border-box;
  padding: 20px;
  @apply(--layout-horizontal);  
  @apply(--layout-center);    
  @apply(--layout-end-justified);
  border-bottom: 1px solid rgba(0,0,0,0.25);
}

/*  .settingsicon {
    height: 40px;
    width: 45px;
    border-left: 1px solid rgba(0,0,0,0.5);
    box-sizing:border-box;
    padding: 5px 0px 5px 15px;
  }
  .settingsicon img {
    height: 30px;
    width: 30px;
  }*/

  .poesprofile {
    height: 100%;
    /*    background-color: rgba(0,0,0,0.05);*/
    @apply(--layout-horizontal);  
    @apply(--layout-center);    
    @apply(--layout-end-justified); 
/*        box-sizing:border-box;
padding: 20px;*/
border-radius: 5px;
}

.smalldetail {
  width: 40px;
  height: 40px;
}


poes-aai {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background-color: rgba(0,0,0,0.05);
  overflow: hidden;
  margin: 0px 0px 0px 10px;
}

.grande {
  width: 200px;
  height: 200px;
  overflow: hidden;
  margin: 50px 0px 0px 0px;
  background-color: rgba(0,0,0,0.05);
}

.alert {
  width: 35px;
  height: 35px;
  margin: 0px 10px 0px 0px;
}

.alerttxt {
  text-align: center;
  @apply(--theme-font-subhead);
  margin: 0px;
  color:#feec46;
  font-size: 22px;
}

.accountinfo {
  width: 100%;
  background-color: var(--pink-theme-color);
  box-sizing:border-box;
  padding: 20px;
  @apply(--theme-alt-general);
  border-bottom: 1px solid rgba(0,0,0,0.25);
}
.accountinfo p {
  @apply(--theme-alt-general);
  font-size: 12px;
}
.drawer h1 {
  @apply(--theme-font-general);
  font-size: 28px;
  line-height: 30px;
}

#drawerpages {
  width: 100%;
}

.btnimg {
  width: 25px;
  height: 25px;
  margin: 0px 0px 0px 6px;
}

.settingsbtn {
  outline: 0; 
  margin: 5px 5px 5px 0px;
  box-sizing:border-box;
  border-radius: 8px;
  cursor: pointer;
  @apply(--theme-font-button);
  background-color: var(--pinktwee-theme-color);
  border:none;
  /*        border: 1px solid rgba(0,0,0,0.5); */
  padding: 12px;
  font-size: 18px;
  @apply(--layout-horizontal);
  @apply(--layout-center-center);  
}

.poestitel {
  width: 100%;
  @apply(--layout-horizontal);
  @apply(--layout-center-center); 
  box-sizing:border-box;
  padding: 20px 0px 0px 0px;
}
.poestitel h2 {
  font-size: 28px;
  margin: 0px;
}
.poestitel img {
  width: 28px;
  margin-left: 5px;
}

.voting {
  width: 100%;
}

poes-admin {
  height: 100%;
  overflow-y:scroll;
}

</style>



<iron-localstorage name="poezenimage" value="{{poezenimage}}"
on-iron-localstorage-load="poes_loaded"></iron-localstorage>
<iron-localstorage name="poezennaam" value="{{poezennaam}}" on-iron-localstorage-load="poes_loaded"></iron-localstorage>
<!--    <iron-localstorage name="mypoescontract" value="{{poescontract}}"></iron-localstorage>-->

<lo-mqtt connected="{{mqttconnected}}" subs
on-message-received="msgreceived"
on-mqtt-connected="mqttconnectedfire"
pincode="{{pincode}}"
id="lomqtt"></lo-mqtt>

<poes-validatie id="poesvalidatie" web3="{{web3}}" account="{{account}}" contractaddress="{{contractaddress}}" on-validation-received="validationreceived" validations="{{validations}}" txhash="{{txhash}}"></poes-validatie>

<poes-membership id="poescontract" web3="{{web3}}" account="{{account}}" balance="{{saldo}}" contract="LocalsMembership.json" memberstatus="{{memberstatus}}" ismember={{ismember}} contractaddress="{{membershipcontract}}" on-contract-ready="_poescontractready"></poes-membership>

<alabs-web3js on-web3-ready="_web3_ready" id="alabsweb3" web3="{{web3}}" accounts="{{accounts}}" account="{{account}}" connected="{{web3connected}}" provider="http://109.123.70.141:8545"></alabs-web3js>


<paper-drawer-panel right-drawer force-narrow id="drawer" drawer-width="330px">
<div drawer>
  <neon-animated-pages id="drawerpages" selected="{{selected}}" 
  entry-animation="fade-in-animation"
  exit-animation="fade-out-animation">
  <neon-animatable>
  <div class="drawer">
    <poes-aai class="grande" catnumber="{{poezenimage}}"></poes-aai>
    <div class="poestitel">
      <h2>{{poezennaam}}</h2>
      <img class="alert" src="../../images/valid.svg">
    </div>
    <div class="whitespace"></div>
    <template is="dom-if" if="{{!validated}}">
      <img class="alert" src="../../images/alert.svg">
      <h3 class="alerttxt">Je bent nog niet gevalideerd</h3>
    </template>



    <template is="dom-if" if="{{validated}}">

      <div class="validatorzsmall vertical layout">
        <p>Je bent gevalideerd door</p>
        <poes-validatordetail pincode="{{pincode}}" id="validator1" ref="validator1" poesobject="{{poesobject1}}" on-poesvalidator-loaded="checkvalidationstate" on-validated="checkvalidationstate" valloadmsg="{{valloadmsg}}" small class="validatordetailsmall"></poes-validatordetail>
        <poes-validatordetail pincode="{{pincode}}" id="validator2" ref="validator2" poesobject="{{poesobject2}}" on-poesvalidator-loaded="checkvalidationstate" on-validated="checkvalidationstate" valloadmsg="{{valloadmsg}}" small class="validatordetailsmall"></poes-validatordetail>
      </div>

    </template>


<!--         <div class="validatorz vertical layout">
          <poes-validatordetail pincode="{{pincode}}" id="validator1" ref="validator1" poesobject="{{poesobject1}}" on-poesvalidator-loaded="checkvalidationstate" on-validated="checkvalidationstate" valloadmsg="{{valloadmsg}}" normal></poes-validatordetail>
          <poes-validatordetail pincode="{{pincode}}" id="validator2" ref="validator2" poesobject="{{poesobject2}}" on-poesvalidator-loaded="checkvalidationstate" on-validated="checkvalidationstate" valloadmsg="{{valloadmsg}}" normal></poes-validatordetail>
        </div> -->
        <div class="whitespace"></div>
        <button class="settingsbtn" on-tap="gotosettings">instellingen<img class="btnimg" src="../../images/cogwheel.svg"></button>
      </div>
    </neon-animatable>
    <neon-animatable>
    <div class="drawer">
      <div class="whitespace"></div>
      <div class="languagepicker">
        <h1><i18n-msg msgid="lang">Your language</i18n-msg></h1>
        <iron-selector 
        attr-for-selected="lang" 
        selected="{{language}}" 
        on-iron-select="langpick"  
        class="languagepickersel">
        <div lang="en" class="language"><h2>EN</h2></div>
        <div lang="nl" class="language"><h2>NL</h2></div>
      </iron-selector>
    </div>        
    <div class="accountinfo">
      <h1><i18n-msg msgid="kitty">KittyClub</i18n-msg><span>{{version}}</span></h1>
      <p><i18n-msg msgid="ethersaldo">My Ether-saldo</i18n-msg></p>
      <p class="clipper">{{saldo}}</p>
      <p><i18n-msg msgid="kittycontract">My KittyClubcontract</i18n-msg></p>
      <p class="clipper">{{membershipcontract}}</p>
      <p><i18n-msg msgid="valcontract">My validationcontract</i18n-msg></p>
      <p class="clipper">{{contractaddress}}</p>
      <p><i18n-msg msgid="valhash">My validation tx hash</i18n-msg></p>
      <p class="clipper">{{txhash}}</p>
    </div>
    <div class="whitespace"></div>
    <button class="settingsbtn" on-tap="gobackdrawer">OK</button>
  </div>
</neon-animatable>
</neon-animated-pages>
</div>

<div main>
  <neon-animated-pages selected="{{state}}" 
  entry-animation="{{entryAnimation}}"
  exit-animation="{{exitAnimation}}"
  attr-for-selected="data-route">


  <neon-animatable data-route="selectpussy">
  <div class="canvaspink">
<!--           <div class="errormsg">
            <template is="dom-if" if="{{!web3connected}}">web3 NOT connected</template>
            <h2>Je bent niet correct geconnecteerd. Probeer het later opnieuw.</h2>
            <template is="dom-if" if="{{mqttconnected}}">mqtt connected</template>
          </div> -->


          <h2><i18n-msg msgid="kieskat">Choose a cat!</i18n-msg></h2>
          <iron-selector id="poezenselector" attr-for-selected="poes" on-iron-select="poezenimage_selected" selected="{{poezenimage}}">
          <div class="poesitem" poes="1">
            <img src="../../images/poezen/poes1.png"></div>
            <div class="poesitem" poes="2">
              <img src="../../images/poezen/poes2.png"></div>
              <div class="poesitem" poes="3">
                <img src="../../images/poezen/poes3.png"></div>
                <div class="poesitem" poes="4">
                  <img src="../../images/poezen/poes4.png"></div>
                  <div class="poesitem" poes="5">
                    <img src="../../images/poezen/poes5.png"></div>
                    <div class="poesitem" poes="6">
                      <img src="../../images/poezen/poes6.png"></div>
                      <div class="poesitem" poes="7">
                        <img src="../../images/poezen/poes7.png"></div>
                        <div class="poesitem" poes="8">
                          <img src="../../images/poezen/poes8.png"></div>
                          <div class="poesitem" poes="9">
                            <img src="../../images/poezen/poes9.png"></div>
                            <div class="poesitem" poes="10">
                              <img src="../../images/poezen/poes10.png"></div>
                              <div class="poesitem" poes="11">
                                <img src="../../images/poezen/poes11.png"></div>
                                <div class="poesitem" poes="12">
                                  <img src="../../images/poezen/poes12.png"></div>
                                  <div class="poesitem" poes="13">
                                    <img src="../../images/poezen/poes13.png"></div>
                                    <div class="poesitem" poes="14">
                                      <img src="../../images/poezen/poes14.png"></div>
                                      <div class="poesitem" poes="15">
                                        <img src="../../images/poezen/poes15.png"></div>
                                        <div class="poesitem" poes="16">
                                          <img src="../../images/poezen/poes16.png"></div>
                                        </iron-selector>
                                        <button on-tap="toNamepussy" class="main">OK</button>
                                      </div>
                                    </neon-animatable>

                                    <neon-animatable data-route="namepussy">
                                    <div class="canvaspink">
                                      <h1><i18n-msg msgid="naamkat1">What's the name</i18n-msg><br><i18n-msg msgid="naamkat2"> of your cat?</i18n-msg></h1>
                                      <div class="whitespace"></div>
                                      <paper-input-container no-label-float>
                                      <input autofocus class="centertexting"
                                      is="iron-input"
                                      prevent-invalid-input
                                      bind-value="{{poezennaam}}"></paper-input-container>
                                      <button on-tap="poezennaam_selected" class="main">OK</button>
                                    </div>
                                  </neon-animatable>
<!--
      <neon-animatable data-route="validate">
        <div class="canvaspink">
          <div class="eighty">
            <h2>Vraag een pincode aan iemand met een gevalideerde poes</h2>
          </div>
          <paper-input-container no-label-float>
            <label class="centertexting">pincode</label>
            <input autofocus class="centertexting"
            is="iron-input"
            prevent-invalid-input
            bind-value="{{enteredpin}}"></paper-input-container>
          <button on-tap="submitpin" class="main">OK</button>
        </div>
      </neon-animatable>
    -->

    <neon-animatable data-route="pin">

    <template is="dom-if" if="{{validated}}">

      <template is="dom-if" if="{{hasenoughcredits}}">

        <div class="canvaspink layout center center">
          <p><i18n-msg msgid="jouwpin">Your pincode</i18n-msg></p>
          <h1>{{pincode}}</h1>
          <small><i18n-msg msgid="saldo1">You can do</i18n-msg><span>{{cleansaldo}}</span><i18n-msg msgid="saldo2"> more validations</i18n-msg></small>
          <button class="medium" on-tap="topussybase"><i18n-msg msgid="backbtn">back</i18n-msg></button>
        </div>

      </template>

      <template is="dom-if" if="{{!hasenoughcredits}}">

        <div class="canvaspink">
          <h1><i18n-msg msgid="enoughmsg">You have validated enough kitties.</i18n-msg></h1>
          <button class="medium" on-tap="topussybase"><i18n-msg msgid="backbtn">back</i18n-msg></button>
        </div>

      </template>

    </template>

    <template is="dom-if" if="{{!validated}}">
      <div class="canvaspink">
        <p><i18n-msg msgid="morevalids">You can only validate some else if you are validated yourself.</i18n-msg></p>
        <button class="medium" on-tap="topussybase"><i18n-msg msgid="backbtn">back</i18n-msg></button>
      </div>
    </template>
  </neon-animatable>

  <neon-animatable data-route="incoming">
  <div class="canvaspink">
    <div class="eighty">
      <h2>{{incomingpussyname}}</h2>
      <div class="incomingpic"><img src="{{incomingpussypic}}" /></div>
      <!--             <p>{{contractaddresstowrite}}</p> -->
    </div>
    <div class="layout horizontal center">
      <button class="medium" on-tap="topussybase"><i18n-msg msgid="cancelbtn">Cancel</i18n-msg></button>
      <button class="main" on-tap="validateRequest"><i18n-msg msgid="validatebtn">Validate</i18n-msg></button>
    </div>
  </div>
</neon-animatable>

<neon-animatable data-route="openbox">
<div class="canvaspink">
  <div class="eighty">
    <h2><i18n-msg msgid="checkpoezendoos">Check the code on the Kittybox</i18n-msg></h2>
  </div>
  <paper-input-container no-label-float>
  <label class="centertexting">pincode</label>
  <input autofocus class="centertexting"
  is="iron-input"
  prevent-invalid-input
  type="number"
  bind-value="{{boxpin}}"></paper-input-container>
  <button on-tap="submitboxpin" class="main">OK</button>
  <button on-tap="toPussybase" class="main"><i18n-msg msgid="cancelbtn">Cancel</i18n-msg></button>
</div>
</neon-animatable>
<neon-animatable data-route="boxchecks">
<div class="canvaspink">
  <div class="eighty">
    <h2><i18n-msg msgid="evengeduld">Even geduld...</i18n-msg></h2>
    <p><i18n-msg msgid="controleert">De poezendoos controleert momenteel of je poes gevalideerd is.</i18n-msg></p>
  </div>
</div>
</neon-animatable>

<neon-animatable data-route="boxisopen">
<div class="canvaspink">
  <div class="eighty">
    <h2><i18n-msg msgid="dedoosis">De doos sluit binnen</i18n-msg> <span>{{countdown}}</span> <i18n-msg msgid="seconden">seconden</i18n-msg>.</h2>
  </div>


</div>
</neon-animatable>



<neon-animatable data-route="clearconfirm">
<div class="canvaspink">
  <div class="eighty">
    <h2><i18n-msg msgid="resetmsg">Do you want to start over?</i18n-msg></h2>
  </div>
  <div class="layout horizontal center">
    <button class="medium" on-tap="topussybase"><i18n-msg msgid="cancelbtn">Cancel</i18n-msg></button>
    <button class="medium" on-tap="opnieuw"><i18n-msg msgid="resetbtn">Start over</i18n-msg></button>
  </div>
</div>
</neon-animatable>




<neon-animatable data-route="pussybase">

<!--           <template is="dom-if" if="{{validated}}">
          <div class="toppertje">
          </div>
        </template> -->

        <div class="topbar">
          <div class="poesprofile" on-tap="openDrawer">
            <template is="dom-if" if="{{!validated}}">
              <img class="alert" src="../../images/alert.svg">
            </template>
            <template is="dom-if" if="{{validated}}">
              <img class="alert" src="../../images/valid.svg">
            </template>

            <h1>{{poezennaam}}</h1>
            <poes-aai catnumber="{{poezenimage}}"></poes-aai>
          </div>
        </div>
        <div class="canvas2pink">
          <!--     <div class="whitespace" on-tap="tohomescreen" >X</div> -->

          <template is="dom-if" if="{{!ismember}}">
            <poezenclub-loader small id="memberloader" loadmsg="{{memberloadermsg}}"></poezenclub-loader>
          </template>

          <template is="dom-if" if="{{!contractaddress}}">
            <poezenclub-loader small id="contractloader" loadmsg="{{contractloadermsg}}"></poezenclub-loader>
          </template>

          <template is="dom-if" if="{{contractaddress}}">
            <template is="dom-if" if="{{validated}}">
              <!--           <button on-tap="openbox" class="main"><i18n-a msgid="openbtn">Open the Kittybox</i18n-msg></button> -->
<!--           <div class="voting">
            <poes-voting account="{{account}}" web3="{{web3}}" voteipfs="QmVvSTWXL2zUxEMrXM7U1vB7EuZG78UtBpW7hqhkpeXHyK" votekey="{{account}}" poezenimage="{{poezenimage}}"></poes-voting>
          </div> -->
          <div class="voting">
            <poes-voting account="{{account}}" web3="{{web3}}" voteipfs="QmR6UPZVMyyFxRniT4WW5yXbkzsKZ5Jxa29RCQtA9z58TV" votekey="{{account}}" poezenimage="{{poezenimage}}" id="voting"></poes-voting>

          </div>



<!--           <template is="dom-if" if="{{hasenoughcredits}}">
            <button on-tap="tooncode" class="valideerbtn"><i18n-msg msgid="validatesomeone">Validate someone</i18n-msg></button>
          </template> -->
        </template>

        <template is="dom-if" if="{{!validated}}">
          <div class="validatorz vertical layout">
            <h2><i18n-msg msgid="getvalidated"></i18n-msg></h2>
            <poes-validatordetail pincode="{{pincode}}" id="validator1" ref="validator1" poesobject="{{poesobject1}}" on-poesvalidator-loaded="checkvalidationstate" on-validated="checkvalidationstate" valloadmsg="{{valloadmsg}}" normal></poes-validatordetail>
            <poes-validatordetail pincode="{{pincode}}" id="validator2" ref="validator2" poesobject="{{poesobject2}}" on-poesvalidator-loaded="checkvalidationstate" on-validated="checkvalidationstate" valloadmsg="{{valloadmsg}}" normal></poes-validatordetail>
          </div>
        </template>

      </template>


    </div>
  </neon-animatable>

  <neon-animatable data-route="homescreen">

  <!--     <poes-voting account="{{account}}" web3="{{web3}}" voteipfs="QmYetjPDKdtj6dbxg5jB4Cq5qoJ28JWVg2M9Qkp5braocF" votekey="{{account}}" poezenimage="{{poezenimage}}"></poes-voting> -->

</neon-animatable>

<neon-animatable data-route="version">

</neon-animatable>

<neon-animatable data-route="admin">
<poes-admin account="{{account}}" web3="{{web3}}"></poes-admin>
</neon-animatable>

</neon-animated-pages>

</div>
</paper-drawer-panel>

</template>
<script>
  (function() {
    'use strict';

    Polymer({
      is: 'poezenclub-stage',

      properties: {
        rout: {
          type: String,
          notify: true,
          observer: 'landed'
        },
        saldo: {
          type: Number,
          notify: true,
          observer: 'saldochanged',
          value: 1
        },

        pincode: {
          type: String,
          notify: true
        },

        entryAnimation: {
          type: String
        },

        exitAnimation: {
          type: String
        },

        ismember: {
          type: Boolean,
          notify:true,
          observer: "_ismemberchanged"
        },
        contractaddress: {
          type: String,
          observer: '_contractaddress'          
        },
        state: {
          type:String,
          observer: '_statechanged'          
        },
        validations: {
          type: Number,
          observer: '_validationschanged'          
        },
        hasenoughcredits: {
          type: Boolean,
          value: true
        },
        validated: {
          type: Boolean,
          value: false
        },
        version: {
          type: String,
          value: ' v0.0.1'
        }
      },

      ready: function(){
        this.makepincode();
        this.exitAnimation = 'slide-down-animation';
        this.entryAnimation = 'slide-down-animation';
        this.state = "selectpussy";

        var hash = window.location.hash;
        if(hash=="#!/admin"){
          this.state = "admin";
        };

        this.$.drawerpages.selected = 0;
      },

      makepincode: function(){
        this.pincode = (Math.floor(Math.random()*90000) + 10000).toString();
      },

      saldochanged: function(){
        console.log('saldo is nu ',this.saldo);
        if (this.saldo > 1){
          this.hasenoughcredits = true;
        }else{
          this.hasenoughcredits = false;
        }
        this.cleansaldo = Math.floor(this.saldo);
      },

      _statechanged: function(){
        console.log('state changed to',this.state);
      },

      _ismemberchanged: function(){
        if (this.ismember){
          this.$.poesvalidatie.createContract();
        }
      },

      topussybase: function(){
        this.boxpin = "";
        this.go('pussybase');
        //this.makepincode();
      },

      tohomescreen: function(){
        this.go('homescreen');
      },

      poes_loaded: function(){
        if (this.poezenimage && this.poezennaam){
          if (this.state == 'selectpussy'){
            //this.go('homescreen');
            this.go('pussybase');
          }
        }
      },

      poezenimage_selected: function(){

      },

      poezennaam_selected: function(){
        this.go('pussybase');
      },

      attached: function(){
        //this.go('selectpussy');
        this.language = 'nl';
        I18nMsg.lang = 'nl';
      I18nMsg.url = 'locales'; // optionally use custom folder for locales.
      Platform.performMicrotaskCheckpoint();
      this.memberloadermsg = "Je lidmaatschap wordt aangemaakt";
      this.contractloadermsg = "Je contract wordt aangemaakt";
      this.valloadmsg = "Je validatie is in aanvraag";
      console.log('attached');
    },

    checkvalidationstate: function(){
        // hier checken of 2 validaties OK zijn.
        // zoja -> toon knop openmaken die doos

        if (this.poesobject1 && this.poesobject1.valid === true && this.poesobject2 && this.poesobject2.valid === true){
          console.log("JE POES IS VALIDE");
          this.validated=true;
        }
      },
      _fixaddress: function(address) {

        function strStartsWith(str, prefix) {
          return str.indexOf(prefix) === 0;
        }

        console.log("Fix address", address);
        if (!strStartsWith(address, '0x')) {
          return ('0x' + address);
        }
        return address;
      },

      validationreceived: function(res){
        console.log("Validation received");
        var validatoraddress = this._fixaddress(res.detail.args.validator);
        console.log("...from",validatoraddress);

        if (this._fixaddress(this.poesobject1.address) == validatoraddress){
          console.log("is from validator1",this.poesobject1);
          return document.getElementById("validator1").setValidated();

        }
        if (this._fixaddress(this.poesobject2.address) == validatoraddress){
          console.log("is from validator2",this.poesobject2);
          return document.getElementById("validator2").setValidated();
        }
        console.log('unknown validator... ignoring this.');
      },

      _validationschanged: function(){

      },

      openDrawer: function(){
        this.$.drawer.togglePanel();
        this.$.drawerpages.selected = 0;
      },

      toNamepussy: function() {
        this.go('namepussy');
      },

      toVersion: function() {
        this.go('version');
      },

      goClear: function(){
        this.go('clearconfirm');
      },

      opnieuw: function(){
        window.localStorage.clear();
        location.reload();
      },


      mqttconnectedfire: function(){
        console.log("MQTT connected");
        this.fire('add-toast', { msg: 'MQTT connected.'});
        // this.subscribetoPin();
      },

      toPussybase: function(){
        this.go('pussybase');
      },

      go: function(tostate){
        console.log('going to state',tostate);
        this.state = tostate;
        switch (tostate){
          case "start":
          case "selectpussy":
            // we come in selectpussy
            //if (this.poezenimage && this.poezennaam){
              this.go('pussybase');
//              this.state = tostate;
            //}
            break;
            case "pussybase":
            break;
          }
        },

        landed: function(){
          console.log('landed in state',this.rout);
        },
 
      initpoes: function(){
        //this.go("selectpussy");
      },

      localpoes: function(){
        //this.go("home");
      },

      validateRequest: function() {
        var self = this;
        // send my pussydetails to the requester..
        this.$.lomqtt.send(this.incomingpin,"validationstarted"+"|"+this.poezenimage+"|"+this.poezennaam+"|"+this.account+"|"+this.incomingref);
        this.$.poesvalidatie.addValidation(this.contractaddresstowrite, function(err, res) {
          console.log("Validatie is started...!");
          //self.go('pussybase');
        });
        this.makepincode();
        this.topussybase();
      },

      openbox: function(){
        this.go('openbox');
      },

      msgreceived: function(e){
        console.log("MSG received: ",e.detail);
        // Split the motherfucking string!
        var commandarray = e.detail.msg.split("|");
        console.log(commandarray);
        switch (commandarray[0]) {
          case "validate":
          console.log("Meneerke wil zijn poes laten valideren");
          this.incomingpussyname = commandarray[1];
          this.incomingpussypic = "../../images/poezen/poes" + commandarray[2] + ".png";
          this.contractaddresstowrite = commandarray[3];
          this.incomingpin = commandarray[4];
          this.incomingref = commandarray[5];
          this.go('incoming');
          break;
          case "validationstarted":
          var ref = commandarray[4];
          var validator_poezenimage = commandarray[1];
          var validator_poezennaam = commandarray[2];
          var validator_account = commandarray[3];
          this.fire("validationstarted for ref",ref);
          document.getElementById(ref).validationStarted(validator_poezennaam,validator_poezenimage,validator_account);
          break;
          case "validatedone":
          console.log("Validatie is done!");
//            this.$.poezenpages.selected = 6;
            //this.go("home");
            break;
            case "doosisopen":
            console.log("De doos is open");
            //this.$.poezenpages.selected = 12;
            this.go("boxisopen");
            //this.$.countdown.start();
            this.startcountdown();
            this.boxpin = null;
            break;

          };

        },

        startcountdown: function(){
          this.countdown = 14;
        //window.setInterval(this.substr(), 250);
        this.set('interval', setInterval(this.substr.bind(this), 1000));
      },

      substr: function(){
        this.countdown = Math.floor(this.countdown-1);
        //console.log("countdown ", this.countdown);
        if(this.countdown==0){
          clearInterval(this.get('interval'));
          this.go('pussybase');
        }
      },

      _contractaddress:function(){
        console.log('Hemme me hiete een contractaddresske' , this.contractaddress);
        this.fire('add-toast', { msg: 'Contract: ' + this.contractaddress});
        if (!this.contractaddress){
          this.hasadress = false;
        } else {
          this.hasadress = true;
        }
      },

      submitboxpin: function(){
        console.log(this.boxpin);
        var pin = this.boxpin;
        //this.$.lomqtt.send("poezendoos/"+pin,"checkContract"+"|"+this.contractaddress+"|"+this.pincode, 2);
        this.$.lomqtt.send("poezendoos/"+pin,"checkVotingContract"+"|"+this.votingcontractaddress+"|"+this._fixaddress(this.address)+"|"+this.pincode, 2);
        this.go("boxchecks");
      },

      closebox: function(){
        this.$.lomqtt.send("poezendoos/"+this.boxpin,"sluitDoos", 2);
        this.topussybase();
        //this.go("home");
      },

      tooncode: function(){
        this.$.poescontract._updateBalance();
        this.go("pin");
      },

      langpick: function(){

        I18nMsg.lang = this.language;

        if(this.language == 'en'){
          this.memberloadermsg = "Your membership is being created";
          this.contractloadermsg = "Your contract is being created";
          this.valloadmsg = "Your validation is being processed";
        };

        if(this.language == 'nl'){
          this.memberloadermsg = "Je lidmaatschap wordt aangemaakt";
          this.contractloadermsg = "Je contract wordt aangemaakt";
          this.valloadmsg = "Je validatie is in aanvraag";
        };  

        Platform.performMicrotaskCheckpoint();
      },


      gotosettings: function(){
        this.$.drawerpages.selected = 1;
      },

      gobackdrawer: function(){
        this.$.drawerpages.selected = 0;
      }

});
})();
</script>
</dom-module>